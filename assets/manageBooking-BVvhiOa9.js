import{_ as X,i as Y,a as Z,r as s,o as c,j as f,w as e,e as t,k as y,a3 as n,a6 as E,ac as ee,aT as ae,l as te,a4 as d,V as m,g as P,d as S,h as C,F as w,ab as le,a1 as oe,f as B,a0 as ne,aa as se,a7 as re,a8 as ie,a9 as U,av as ce}from"./index-BAIVBLcN.js";import{u as ue,f as A,V as de}from"./vee-validate.esm-BVImtnm1.js";import{u as fe}from"./bookingOrder-qYKUbd8I.js";import{b as L}from"./route-block-B_A1xBdJ.js";import{V as r}from"./VCol-Dz4HUTzj.js";import{a as g,V as me}from"./VRow-RbgkkUBJ.js";import{r as ge}from"./VDataTable-CYAESP2L.js";import{a as pe,V as ve}from"./VList-BH5BWzQ_.js";import"./VPagination-D4JZ4sj6.js";import"./VCheckboxBtn-C0eZXGem.js";import"./VDivider-BSQRZDT2.js";const M=p=>(re("data-v-56b140fe"),p=p(),ie(),p),_e=M(()=>U("h1",null,"預約管理",-1)),ke=M(()=>U("h3",{class:"confirmCancelText"},"是否要取消訂單？",-1)),z={__name:"manageBooking",setup(p){const{apiAuth:H}=ce(),b=Y(),R=Z(),$=fe();s(R.account);const V=s(""),v=s([]),q=[{align:"center",title:"訂單編號",key:"bookingOrderNumber"},{align:"center",title:"訂單狀態",key:"orderStatus"},{align:"center",title:"下單日期",key:"createdAt",value:l=>new Date(l.createdAt).toLocaleString()},{align:"center",title:"帳號名稱",key:"accountName"},{align:"center",title:"預約人",key:"name"},{align:"center",title:"電話",key:"phone"},{align:"center",title:"預約狗狗",key:"dogName"},{align:"center",title:"圖片",key:"image"},{align:"center",title:"預約日期",key:"bookingDate"},{align:"center",title:"預約時段",key:"bookingTime"},{align:"center",title:"預約總時數",key:"totalBookingTime"},{align:"center",title:"預約總金額",key:"totalPrice"}],I=async()=>{var l,o;try{const{data:a}=await H.get("/order/all");v.value.splice(0,v.value.length,...a.result.data)}catch(a){console.log(a),b({text:((o=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}};I();const x=s(null),G=()=>{x.value=!1},i=s([{title:"訂單編號",value:""},{title:"預約人",value:""},{title:"電話",value:0},{title:"預約狗狗",value:""},{title:"預約日期",value:""},{title:"預約總金額",value:"0 元"}]),T=s({title:"圖片",image:""}),D=s({title:"Id",id:""}),_=s(!1),J=l=>{l&&(console.log("item",l.value),i.value[0].value=l.bookingOrderNumber,i.value[1].value=l.name,i.value[2].value=l.phone,i.value[3].value=l.dogName,i.value[4].value=l.bookingDate,i.value[5].value=l.totalPrice,T.value.image=l.image,D.value.id=l._id,x.value=l.orderStatus),_.value=!0},N=()=>{_.value=!1},k=s(!1),O=()=>{k.value=!k.value},K=()=>{k.value=!1},j=(l,o)=>{const a=v.value.find(u=>u._id===l);a&&(a.orderStatus=o)},{handleSubmit:Q,isSubmitting:F,resetForm:he}=ue({initialValues:{id:"",orderStatus:""}});A("id"),A("orderStatus");const W=Q(async l=>{try{l.id=D.value.id,l.orderStatus=x.value;const o=await $.edit(l);o.text==="修改訂單成功"&&(j(l.id,o.reOrderStatus),b({text:o.text,snackbarProps:{color:"green"}})),N()}catch(o){console.log(o),b({text:result,snackbarProps:{color:"red"}})}});return(l,o)=>(c(),f(me,{fluid:""},{default:e(()=>[t(g,{class:"text-center"},{default:e(()=>[t(r,null,{default:e(()=>[_e]),_:1})]),_:1}),t(g,{class:"text-center"},{default:e(()=>[t(r,null,{default:e(()=>[t(y,{class:"d-inline-flex pa-4",color:"green",onClick:I},{default:e(()=>[n("查詢預約")]),_:1})]),_:1})]),_:1}),t(le,{class:"mt-8",flat:""},{text:e(()=>[t(E,{modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=a=>V.value=a),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),default:e(()=>[t(ee,null,{default:e(()=>[n("查詢預約資料")]),_:1}),t(ge,{headers:q,items:v.value,search:V.value},{"item.orderStatus":e(({value:a,item:u})=>[t(g,{class:"flex-column justify-content-center my-6"},{default:e(()=>[t(r,{class:"pa-0"},{default:e(()=>[t(ae,{"onUpdate:modelValue":j,text:a?"已預約":"已取消",color:a?"green":"red",size:"default"},null,8,["text","color"])]),_:2},1024),t(r,{class:"pa-0 mt-4"},{default:e(()=>[a?(c(),f(y,{key:0,class:"cancelBtnCss",variant:"flat",flat:"",onClick:h=>J(u)},{default:e(()=>[n("取消訂單")]),_:2},1032,["onClick"])):te("",!0)]),_:2},1024)]),_:2},1024)]),"item.createdAt":e(({value:a})=>[n(d(a.split(" ")[0]),1)]),"item.image":e(({value:a})=>[t(m,{class:"bg-transparent my-2",width:"70",height:"70",rounded:"lg",elevation:"2"},{default:e(()=>[t(P,{src:a,class:"w-100 h-100",rounded:"lg",cover:""},null,8,["src"])]),_:2},1024)]),"item.bookingTime":e(({value:a})=>[t(pe,null,{default:e(()=>[(c(!0),S(w,null,C(a.join(" ").split(",").sort((u,h)=>parseInt(u)-parseInt(h)),(u,h)=>(c(),f(ve,{key:h},{default:e(()=>[n(d(u),1)]),_:2},1024))),128))]),_:2},1024)]),"item.totalBookingTime":e(({value:a})=>[n(d(a?a+" 小時":"無資料"),1)]),"item.totalPrice":e(({value:a})=>[n(d(a)+" 元 ",1)]),_:2},1032,["items","search"])]),_:1}),t(se,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=a=>_.value=a)},{default:e(()=>[t(de,{onSubmit:oe(B(W),["prevent"]),disabled:B(F)},{default:e(()=>[t(m,{class:"bg-white d-flex flex-column justify-self-center align-self-center justify-center pa-7","max-width":"600",height:"auto"},{default:e(()=>[t(m,{class:"bg-transparent d-flex flex-wrap justify-center align-self-center"},{default:e(()=>[ke,t(m,{class:"bg-transparent d-flex w-100 my-6"},{default:e(()=>[t(r,null,{default:e(()=>[(c(!0),S(w,null,C(i.value,a=>(c(),f(g,{key:a.value},{default:e(()=>[t(r,{class:"confirmCancelDataBorderCss"},{default:e(()=>[n(d(a.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(r,null,{default:e(()=>[(c(!0),S(w,null,C(i.value,a=>(c(),f(g,{key:a.value},{default:e(()=>[t(r,{class:"confirmCancelDataBorderCss"},{default:e(()=>[n(d(a.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(r,{class:"pa-0 ms-4 d-flex justify-center align-center"},{default:e(()=>[t(P,{src:T.value.image,width:"160",height:"100%",cover:""},null,8,["src"])]),_:1})]),_:1}),t(y,{class:"confirmCancelBtn my-6",type:"submit",variant:"plain",flat:"",onClick:G,loading:B(F)},{default:e(()=>[n("確認取消")]),_:1},8,["loading"])]),_:1}),t(m,{class:"dialogClosePosition rounded-circle bg-transparent d-flex"},{default:e(()=>[t(y,{class:"rounded-circle d-flex pa-0 bg-white opacity-100","min-width":"60","min-height":"60",variant:"plain",onClick:N,flat:""},{default:e(()=>[t(ne,{icon:k.value?"mdi-close-circle":"mdi-close-circle-outline",size:"48",color:"red-darken-4",onMouseover:O,onMouseout:O,onClick:K},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]),_:1}))}};typeof L=="function"&&L(z);const Ne=X(z,[["__scopeId","data-v-56b140fe"]]);export{Ne as default};
