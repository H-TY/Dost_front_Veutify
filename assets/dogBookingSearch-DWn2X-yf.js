import{_ as Y,i as Z,a as E,r as n,o as c,j as f,w as e,e as t,k as y,a2 as s,a5 as ee,ab as ae,aP as te,l as le,a3 as d,V as m,f as F,d as x,g as C,F as w,aa as oe,a1 as se,h as B,a0 as ne,a9 as re,a6 as ie,a7 as ce,a8 as L,aQ as ue}from"./index-BxqQNHH_.js";import{u as de,f as A,V as fe}from"./vee-validate.esm-BmkkhYC1.js";import{u as me}from"./bookingOrder-BQukXWEJ.js";import{b as U}from"./route-block-B_A1xBdJ.js";import{V as r}from"./VCol-Drg_UCgN.js";import{a as g,V as ge}from"./VRow-CuzbfiEd.js";import{r as pe}from"./VDataTable-wuc6i5yN.js";import{a as ve,V as _e}from"./VList-ORYvcCOc.js";import"./VPagination-BJTiY_FI.js";import"./VCheckboxBtn-BC6pGtHs.js";import"./VDivider-SKwL9evb.js";const M=p=>(ie("data-v-4782b7da"),p=p(),ce(),p),ke=M(()=>L("h1",null,"預約狗狗查詢",-1)),he=M(()=>L("h3",{class:"confirmCancelText"},"是否要取消訂單？",-1)),z={__name:"dogBookingSearch",setup(p){const{apiAuth:H}=ue(),b=Z(),Q=E(),R=me(),$=n(Q.account),V=n(""),v=n([]),q=[{align:"center",title:"訂單編號",key:"bookingOrderNumber"},{align:"center",title:"訂單狀態",key:"orderStatus"},{align:"center",title:"下單日期",key:"createdAt",value:l=>new Date(l.createdAt).toLocaleString()},{align:"center",title:"預約人",key:"name"},{align:"center",title:"電話",key:"phone"},{align:"center",title:"預約狗狗",key:"dogName"},{align:"center",title:"圖片",key:"image"},{align:"center",title:"預約日期",key:"bookingDate"},{align:"center",title:"預約時段",key:"bookingTime"},{align:"center",title:"預約總時數",key:"totalBookingTime"},{align:"center",title:"預約總金額",key:"totalPrice"}],I=async()=>{var l,o;try{const{data:a}=await H.get("/order",{params:{search:$.value}});v.value.splice(0,v.value.length,...a.result.data)}catch(a){console.log(a),b({text:((o=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}};I();const S=n(null),G=()=>{S.value=!1},i=n([{title:"訂單編號",value:""},{title:"預約人",value:""},{title:"電話",value:0},{title:"預約狗狗",value:""},{title:"預約日期",value:""},{title:"預約總金額",value:"0 元"}]),T=n({title:"圖片",image:""}),D=n({title:"Id",id:""}),_=n(!1),J=l=>{l&&(i.value[0].value=l.bookingOrderNumber,i.value[1].value=l.name,i.value[2].value=l.phone,i.value[3].value=l.dogName,i.value[4].value=l.bookingDate,i.value[5].value=l.totalPrice,T.value.image=l.image,D.value.id=l._id,S.value=l.orderStatus),_.value=!0},O=()=>{_.value=!1},k=n(!1),N=()=>{k.value=!k.value},K=()=>{k.value=!1},P=(l,o)=>{const a=v.value.find(u=>u._id===l);a&&(a.orderStatus=o)},{handleSubmit:W,isSubmitting:j,resetForm:ye}=de({initialValues:{id:"",orderStatus:""}});A("id"),A("orderStatus");const X=W(async l=>{try{l.id=D.value.id,l.orderStatus=S.value;const o=await R.edit(l);o.text==="修改訂單成功"&&(P(l.id,o.reOrderStatus),b({text:o.text,snackbarProps:{color:"green"}})),O()}catch(o){console.log(o),b({text:result,snackbarProps:{color:"red"}})}});return(l,o)=>(c(),f(ge,{class:"my-5",fluid:""},{default:e(()=>[t(g,{class:"text-center"},{default:e(()=>[t(r,null,{default:e(()=>[ke]),_:1})]),_:1}),t(g,{class:"text-center"},{default:e(()=>[t(r,null,{default:e(()=>[t(y,{color:"green",onClick:I},{default:e(()=>[s("查詢預約")]),_:1})]),_:1})]),_:1}),t(oe,{class:"mt-8",flat:""},{text:e(()=>[t(ee,{modelValue:V.value,"onUpdate:modelValue":o[0]||(o[0]=a=>V.value=a),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),default:e(()=>[t(ae,null,{default:e(()=>[s("查詢預約結果")]),_:1}),t(pe,{headers:q,items:v.value,search:V.value},{"item.orderStatus":e(({value:a,item:u})=>[t(g,{class:"flex-column justify-content-center my-6"},{default:e(()=>[t(r,{class:"pa-0"},{default:e(()=>[t(te,{"onUpdate:modelValue":P,text:a?"已預約":"已取消",color:a?"green":"red",size:"default"},null,8,["text","color"])]),_:2},1024),t(r,{class:"pa-0 mt-4"},{default:e(()=>[a?(c(),f(y,{key:0,class:"cancelBtnCss",variant:"flat",flat:"",onClick:h=>J(u)},{default:e(()=>[s("取消訂單")]),_:2},1032,["onClick"])):le("",!0)]),_:2},1024)]),_:2},1024)]),"item.createdAt":e(({value:a})=>[s(d(a.split(" ")[0]),1)]),"item.image":e(({value:a})=>[t(m,{class:"bg-transparent my-2",elevation:"2",rounded:""},{default:e(()=>[t(F,{src:a,width:"70",height:"70",cover:""},null,8,["src"])]),_:2},1024)]),"item.bookingTime":e(({value:a})=>[t(ve,null,{default:e(()=>[(c(!0),x(w,null,C(a.join(" ").split(",").sort((u,h)=>parseInt(u)-parseInt(h)),(u,h)=>(c(),f(_e,{key:h},{default:e(()=>[s(d(u),1)]),_:2},1024))),128))]),_:2},1024)]),"item.totalBookingTime":e(({value:a})=>[s(d(a?a+" 小時":"無資料"),1)]),"item.totalPrice":e(({value:a})=>[s(d(a)+" 元 ",1)]),_:2},1032,["items","search"])]),_:1}),t(re,{modelValue:_.value,"onUpdate:modelValue":o[1]||(o[1]=a=>_.value=a)},{default:e(()=>[t(fe,{onSubmit:se(B(X),["prevent"]),disabled:B(j)},{default:e(()=>[t(m,{class:"bg-white d-flex flex-column justify-self-center align-self-center justify-center pa-7","max-width":"600",height:"auto"},{default:e(()=>[t(m,{class:"bg-transparent d-flex flex-wrap justify-center align-self-center"},{default:e(()=>[he,t(m,{class:"bg-transparent d-flex w-100 my-6"},{default:e(()=>[t(r,null,{default:e(()=>[(c(!0),x(w,null,C(i.value,a=>(c(),f(g,{key:a.value},{default:e(()=>[t(r,{class:"confirmCancelDataBorderCss"},{default:e(()=>[s(d(a.title),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(r,null,{default:e(()=>[(c(!0),x(w,null,C(i.value,a=>(c(),f(g,{key:a.value},{default:e(()=>[t(r,{class:"confirmCancelDataBorderCss"},{default:e(()=>[s(d(a.value),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),t(r,{class:"pa-0 ms-4 d-flex justify-center align-center"},{default:e(()=>[t(F,{src:T.value.image,width:"160",height:"100%",cover:""},null,8,["src"])]),_:1})]),_:1}),t(y,{class:"confirmCancelBtn my-6",type:"submit",variant:"plain",flat:"",onClick:G,loading:B(j)},{default:e(()=>[s("確認取消")]),_:1},8,["loading"])]),_:1}),t(m,{class:"dialogClosePosition rounded-circle bg-transparent d-flex"},{default:e(()=>[t(y,{class:"rounded-circle d-flex pa-0 bg-white opacity-100","min-width":"60","min-height":"60",variant:"plain",onClick:O,flat:""},{default:e(()=>[t(ne,{icon:k.value?"mdi-close-circle":"mdi-close-circle-outline",size:"48",color:"red-darken-4",onMouseover:N,onMouseout:N,onClick:K},null,8,["icon"])]),_:1})]),_:1})]),_:1})]),_:1},8,["onSubmit","disabled"])]),_:1},8,["modelValue"])]),_:1}))}};typeof U=="function"&&U(z);const Ne=Y(z,[["__scopeId","data-v-4782b7da"]]);export{Ne as default};
