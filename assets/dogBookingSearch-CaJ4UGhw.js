import{u as Z,f as w}from"./vee-validate.esm-B39F4iJh.js";import{_ as $,i as q,a as G,r,o as g,j as _,w as a,e as l,k as B,a3 as i,a5 as H,a8 as J,aU as K,l as M,a4 as f,V as Q,g as W,d as X,h as Y,F as E,a7 as ee,f as S,a6 as te,av as ae,aw as le,Z as oe,au as re}from"./index-flPRigKX.js";import{u as se}from"./bookingOrder-DG2nHeZp.js";import{O as ne}from"./orderInfoCard-BL9KjB-M.js";import{b as D}from"./route-block-B_A1xBdJ.js";import{V as p}from"./VCol-r5V6bekc.js";import{V as h}from"./VRow-CeCKLXZ0.js";import{r as ie}from"./VDataTable-BMgxDepx.js";import{a as ue,V as ce}from"./VList-B__T0h3C.js";import{V as de}from"./VContainer-D1WJo91_.js";import"./VPagination-CyXYGOis.js";import"./VCheckboxBtn-DOAeSlrw.js";import"./VDivider-HjvlQjxz.js";const me=u=>(ae("data-v-c9de649f"),u=u(),le(),u),ge=me(()=>oe("h1",null,"預約狗狗查詢",-1)),O={__name:"dogBookingSearch",setup(u){const{apiAuth:T}=re(),v=q(),N=G(),F=se(),P=r(N.account),k=r(""),c=r([]),U=[{align:"center",title:"訂單編號",key:"bookingOrderNumber"},{align:"center",title:"訂單狀態",key:"orderStatus"},{align:"center",title:"下單日期",key:"createdAt",value:t=>new Date(t.createdAt).toLocaleString()},{align:"center",title:"預約人",key:"name"},{align:"center",title:"電話",key:"phone"},{align:"center",title:"預約狗狗",key:"dogName"},{align:"center",title:"圖片",key:"image"},{align:"center",title:"預約日期",key:"bookingDate"},{align:"center",title:"預約時段",key:"bookingTime"},{align:"center",title:"預約總時數",key:"totalBookingTime"},{align:"center",title:"預約總金額",key:"totalPrice"}],b=async()=>{var t,o;try{const{data:e}=await T.get("/order",{params:{search:P.value}});c.value.splice(0,c.value.length,...e.result.data)}catch(e){console.log(e),v({text:((o=(t=e==null?void 0:e.response)==null?void 0:t.data)==null?void 0:o.message)||"發生錯誤",snackbarProps:{color:"red"}})}};b();const V=r(null),A=()=>{V.value=!1},s=r([{title:"訂單編號",value:""},{title:"預約人",value:""},{title:"電話",value:0},{title:"預約狗狗",value:""},{title:"預約日期",value:""},{title:"預約總金額",value:"0 元"}]),y=r(""),I=r(""),d=r(!1),L=t=>{t&&(s.value[0].value=t.bookingOrderNumber,s.value[1].value=t.name,s.value[2].value=t.phone,s.value[3].value=t.dogName,s.value[4].value=t.bookingDate,s.value[5].value=t.totalPrice,y.value=t.image,I.value=t._id,V.value=t.orderStatus),d.value=!0},x=()=>{d.value=!1},C=(t,o)=>{const e=c.value.find(n=>n._id===t);e&&(e.orderStatus=o)},{handleSubmit:j,isSubmitting:z,resetForm:fe}=Z({initialValues:{id:"",orderStatus:""}});w("id"),w("orderStatus");const R=j(async t=>{try{t.id=I.value,t.orderStatus=V.value;const o=await F.edit(t);o.text==="修改訂單成功"&&(C(t.id,o.reOrderStatus),v({text:o.text,snackbarProps:{color:"green"}})),x()}catch(o){console.log(o),v({text:result,snackbarProps:{color:"red"}})}});return(t,o)=>(g(),_(de,{class:"my-5",fluid:""},{default:a(()=>[l(h,{class:"text-center"},{default:a(()=>[l(p,null,{default:a(()=>[ge]),_:1})]),_:1}),l(h,{class:"text-center"},{default:a(()=>[l(p,null,{default:a(()=>[l(B,{color:"green",onClick:b},{default:a(()=>[i("查詢預約")]),_:1})]),_:1})]),_:1}),l(ee,{class:"mt-8",flat:""},{text:a(()=>[l(H,{modelValue:k.value,"onUpdate:modelValue":o[0]||(o[0]=e=>k.value=e),label:"Search","prepend-inner-icon":"mdi-magnify",variant:"outlined","hide-details":"","single-line":""},null,8,["modelValue"])]),default:a(()=>[l(J,null,{default:a(()=>[i("查詢預約結果")]),_:1}),l(ie,{headers:U,items:c.value,search:k.value},{"item.orderStatus":a(({value:e,item:n})=>[l(h,{class:"flex-column justify-content-center my-6"},{default:a(()=>[l(p,{class:"pa-0"},{default:a(()=>[l(K,{"onUpdate:modelValue":C,text:e?"已預約":"已取消",color:e?"green":"red",size:"default"},null,8,["text","color"])]),_:2},1024),l(p,{class:"pa-0 mt-4"},{default:a(()=>[e?(g(),_(B,{key:0,class:"cancelBtnCss",variant:"flat",flat:"",onClick:m=>L(n)},{default:a(()=>[i("取消訂單")]),_:2},1032,["onClick"])):M("",!0)]),_:2},1024)]),_:2},1024)]),"item.createdAt":a(({value:e})=>[i(f(e.split(" ")[0]),1)]),"item.image":a(({value:e})=>[l(Q,{class:"bg-transparent my-2",width:"70",height:"70",rounded:"lg",elevation:"2"},{default:a(()=>[l(W,{src:e,class:"w-100 h-100",rounded:"lg",cover:""},null,8,["src"])]),_:2},1024)]),"item.bookingTime":a(({value:e})=>[l(ue,null,{default:a(()=>[(g(!0),X(E,null,Y(e.join(" ").split(",").sort((n,m)=>parseInt(n)-parseInt(m)),(n,m)=>(g(),_(ce,{key:m},{default:a(()=>[i(f(n),1)]),_:2},1024))),128))]),_:2},1024)]),"item.totalBookingTime":a(({value:e})=>[i(f(e?e+" 小時":"無資料"),1)]),"item.totalPrice":a(({value:e})=>[i(f(e)+" 元 ",1)]),_:2},1032,["items","search"])]),_:1}),l(te,{modelValue:d.value,"onUpdate:modelValue":o[1]||(o[1]=e=>d.value=e)},{default:a(()=>[l(S(ne),{bigTitle:"是否要取消訂單？",orderInfoData:s.value,orderInfoDataImg:y.value,changeOrderStatus:A,dialogClose:x,submit:S(R),isSubmitting:S(z)},null,8,["orderInfoData","orderInfoDataImg","submit","isSubmitting"])]),_:1},8,["modelValue"])]),_:1}))}};typeof D=="function"&&D(O);const Be=$(O,[["__scopeId","data-v-c9de649f"]]);export{Be as default};
